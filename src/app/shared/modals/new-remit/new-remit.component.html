<div class="d-flex justify-content-between m-3">
    <span class="h5">Εισαγωγή Νέας Αρμοδιότητας</span>
    <button
        type="button"
        class="btn-close"
        (click)="modalRef.dismiss()"></button>
</div>

<div class="modal-body">
    <div class="card">
        <div class="card-header d-flex flex-column justify-content-between">
            <table>
                <tr>
                    <td class="fw-semibold">Φορέας:</td>
                    <td>{{ organization?.preferredLabel }}</td>
                    <td class="text-muted">Κωδικός Απογραφής Φορέα:</td>
                    <td class="text-muted text-end">{{ organization?.code }}</td>
                </tr>
                <tr>
                    <td class="fw-semibold">Μονάδα:</td>
                    <td>{{ organizationUnit.preferredLabel }}</td>
                    <td class="text-muted">Κωδικός Απογραφής Μονάδας:</td>
                    <td class="text-muted text-end">{{ organizationUnit.code }}</td>
                </tr>
            </table>
        </div>
        <div class="card-body">
            <form [formGroup]="form">
                <div class="mb-3">
                    <label
                        for="remitText"
                        class="form-label">
                        Κείμενο αρμοδιότητας:
                    </label>
                    <textarea
                        ngbAutoFocus
                        class="form-control"
                        [class.is-invalid]="form.controls.remitText.touched && form.controls.remitText.invalid"
                        id="remitText"
                        formControlName="remitText"></textarea>
                    @if (form.controls.remitText.touched && form.controls.remitText.invalid) {
                        <div class="invalid-feedback">Το πεδίο είναι υποχρεωτικό</div>
                    }
                </div>

                <div class="mb-3 d-flex gap-3">
                    <div class="w-50">
                        <label
                            for="remitType"
                            class="form-label">
                            Τύπος Αρμοδιότητας:
                        </label>
                        <select
                            class="form-select"
                            [class.is-invalid]="form.controls.remitType.touched && form.controls.remitType.invalid"
                            aria-label="Default select example"
                            id="remitType"
                            formControlName="remitType">
                            <option
                                value=""
                                disabled
                                selected>
                                Επιλέξτε Τύπο Αρμοδιότητας
                            </option>
                            @for (remitType of remitTypes; track $index) {
                                <option [ngValue]="remitType">{{ remitType }}</option>
                            }
                        </select>
                        @if (form.controls.remitType.touched && form.controls.remitType.invalid) {
                            <div class="invalid-feedback">Το πεδίο είναι υποχρεωτικό</div>
                        }
                    </div>
                    <div class="w-50">
                        <label
                            for="cofog1"
                            class="form-label">
                            Λειτουργική Περιοχή COFOG:
                        </label>
                        <select
                            class="form-select"
                            [class.is-invalid]="form.controls.cofog1.touched && form.controls.cofog1.invalid"
                            aria-label="Default select example"
                            id="cofog1"
                            formControlName="cofog1">
                            <option
                                value=""
                                disabled
                                selected>
                                Επιλέξτε Λειτουργική Περιοχή COFOG
                            </option>
                            @for (cofog of cofog1; track $index) {
                                <option [ngValue]="cofog.code">{{ cofog.name }}</option>
                            }
                        </select>
                        @if (form.controls.cofog1.touched && form.controls.cofog1.invalid) {
                            <div class="invalid-feedback">Το πεδίο είναι υποχρεωτικό</div>
                        }
                    </div>
                </div>

                @if (cofog1_selected) {
                    <div class="mb-3 d-flex gap-3">
                        <div class="w-50">
                            <label
                                for="cofog2"
                                class="form-label">
                                Λειτουργικός Τομέας COFOG:
                            </label>
                            <select
                                class="form-select"
                                [class.is-invalid]="form.controls.cofog2.touched && form.controls.cofog2.invalid"
                                aria-label="Default select example"
                                id="cofog2"
                                formControlName="cofog2">
                                <option
                                    value=""
                                    disabled
                                    selected>
                                    Επιλέξτε Λειτουργικό Τομέα COFOG
                                </option>
                                @for (cofog of cofog2; track $index) {
                                    <option [ngValue]="cofog.code">{{ cofog.name }}</option>
                                }
                            </select>
                            @if (form.controls.cofog2.touched && form.controls.cofog2.invalid) {
                                <div class="invalid-feedback">Το πεδίο είναι υποχρεωτικό</div>
                            }
                        </div>
                        @if (cofog2_selected) {
                            <div class="w-50">
                                <label
                                    for="cofog3"
                                    class="form-label">
                                    Θεματική Περιοχή COFOG:
                                </label>
                                <select
                                    class="form-select"
                                    [class.is-invalid]="form.controls.cofog3.touched && form.controls.cofog3.invalid"
                                    aria-label="Default select example"
                                    id="cofog3"
                                    formControlName="cofog3">
                                    <option
                                        value=""
                                        disabled
                                        selected>
                                        Επιλέξτε Θεματική Περιοχή COFOG
                                    </option>
                                    @for (cofog of cofog3; track $index) {
                                        <option [ngValue]="cofog.code">{{ cofog.name }}</option>
                                    }
                                </select>
                                @if (form.controls.cofog3.touched && form.controls.cofog3.invalid) {
                                    <div class="invalid-feedback">Το πεδίο είναι υποχρεωτικό</div>
                                }
                            </div>
                        }
                    </div>
                }

                @if (!legalProvisionSpecs || !legalActKey) {
                    <div class="mb-3 d-flex gap-2">
                        <button
                            type="button"
                            class="btn btn-primary"
                            (click)="addLegalProvision()"
                            [disabled]="!canAddLegalProvision">
                            Εισαγωγή Διάταξης
                        </button>
                    </div>
                } @else {
                    <div class="d-flex gap-3">
                        <div class="mb-3 d-flex flex-column flex-grow-1 gap-2">
                            <div>
                                <label
                                    for="legalAct"
                                    class="form-label">
                                    Νομική Πράξη:
                                </label>
                                <input
                                    type="text"
                                    class="form-control"
                                    id="legalAct"
                                    [value]="legalActKey"
                                    formControlName="legalActKey"
                                    readonly />
                            </div>
                            <div
                                class="d-flex gap-2 justify-content-between"
                                formGroupName="legalProvisionSpecs">
                                <div>
                                    <label
                                        for="meros"
                                        class="form-label">
                                        Μέρος:
                                    </label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="meros"
                                        formControlName="meros"
                                        [value]="legalProvisionSpecs.meros"
                                        readonly />
                                </div>
                                <div>
                                    <label
                                        for="arthro"
                                        class="form-label">
                                        Άρθρο:
                                    </label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="arthro"
                                        formControlName="arthro"
                                        [value]="legalProvisionSpecs.arthro"
                                        readonly />
                                </div>
                                <div>
                                    <label
                                        for="paragrafos"
                                        class="form-label">
                                        Παράγραφος:
                                    </label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="paragrafos"
                                        formControlName="paragrafos"
                                        [value]="legalProvisionSpecs.paragrafos"
                                        readonly />
                                </div>
                                <div>
                                    <label
                                        for="edafio"
                                        class="form-label">
                                        Εδάφιο:
                                    </label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="edafio"
                                        formControlName="edafio"
                                        [value]="legalProvisionSpecs.edafio"
                                        readonly />
                                </div>
                                <div>
                                    <label
                                        for="pararthma"
                                        class="form-label">
                                        Παράρτημα:
                                    </label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="pararthma"
                                        formControlName="pararthma"
                                        [value]="legalProvisionSpecs.pararthma"
                                        readonly />
                                </div>
                            </div>
                        </div>
                        <button
                            class="btn btn-primary btn-small"
                            (click)="addLegalProvision()">
                            Αλλαγή
                        </button>
                    </div>
                }

                <button
                    type="button"
                    class="btn btn-primary"
                    (click)="onSubmit()"
                    [disabled]="!form.valid">
                    Υποβολή
                </button>
            </form>
        </div>
    </div>
</div>
