<div class="d-flex justify-content-between m-3">
    <span class="h5">Εισαγωγή Νέας Αρμοδιότητας</span>
    <button type="button" class="btn-close" (click)="modalRef.dismiss()"></button>
</div>

<div class="modal-body">
    <div class="card">
        <div class="card-header d-flex flex-column justify-content-between">
            <table>
                <tr>
                    <td class="fw-semibold">Φορέας:</td>
                    <td>{{ organization?.preferredLabel }}</td>
                    <td class="text-muted">Κωδικός Απογραφής Φορέα:</td>
                    <td class="text-muted text-end">{{ organization?.code }}</td>
                </tr>
                <tr>
                    <td class="fw-semibold">Μονάδα:</td>
                    <td>{{ organizationUnit.preferredLabel }}</td>
                    <td class="text-muted">Κωδικός Απογραφής Μονάδας:</td>
                    <td class="text-muted text-end">{{ organizationUnit.code }}</td>
                </tr>
            </table>
        </div>
        <div class="card-body">
            <form [formGroup]="form" (ngSubmit)="onSubmit()">
                <div class="mb-3">
                    <label for="remitText" class="form-label">Κείμενο αρμοδιότητας:</label>
                    <textarea
                        ngbAutoFocus
                        class="form-control"
                        [class.is-invalid]="form.controls.remitText.touched && form.controls.remitText.invalid"
                        id="remitText"
                        formControlName="remitText"
                    ></textarea>
                    @if (form.controls.remitText.touched && form.controls.remitText.invalid) {
                        <div class="invalid-feedback">Το πεδίο είναι υποχρεωτικό</div>
                    }
                </div>

                <div class="mb-3">
                    <label for="remitType" class="form-label">Τύπος Αρμοδιότητας:</label>
                    <select
                        class="form-select"
                        [class.is-invalid]="form.controls.remitType.touched && form.controls.remitType.invalid"
                        aria-label="Default select example"
                        id="remitType"
                        formControlName="remitType"
                    >
                        <option value="" disabled selected>Επιλέξτε Τύπο Αρμοδιότητας</option>
                        @for (remitType of remitTypes; track $index) {
                            <option [ngValue]="remitType">{{ remitType }}</option>
                        }
                    </select>
                    @if (form.controls.remitType.touched && form.controls.remitType.invalid) {
                        <div class="invalid-feedback">Το πεδίο είναι υποχρεωτικό</div>
                    }
                </div>

                <div class="mb-3">
                    <label for="cofog1" class="form-label">Λειτουργική Περιοχή COFOG:</label>
                    <select
                        class="form-select"
                        [class.is-invalid]="form.controls.cofog1.touched && form.controls.cofog1.invalid"
                        aria-label="Default select example"
                        id="cofog1"
                        formControlName="cofog1"
                    >
                        <option value="" disabled selected>Επιλέξτε Λειτουργική Περιοχή COFOG</option>
                        @for (cofog of cofog1; track $index) {
                            <option [ngValue]="cofog.code">{{ cofog.name }}</option>
                        }
                    </select>
                    @if (form.controls.cofog1.touched && form.controls.cofog1.invalid) {
                        <div class="invalid-feedback">Το πεδίο είναι υποχρεωτικό</div>
                    }
                </div>

                @if (cofog1_selected) {
                    <div class="mb-3">
                        <label for="cofog2" class="form-label">Λειτουργικός Τομέας COFOG:</label>
                        <select
                            class="form-select"
                            [class.is-invalid]="form.controls.cofog2.touched && form.controls.cofog2.invalid"
                            aria-label="Default select example"
                            id="cofog2"
                            formControlName="cofog2"
                        >
                            <option value="" disabled selected>Επιλέξτε Λειτουργικό Τομέα COFOG</option>
                            @for (cofog of cofog2; track $index) {
                                <option [ngValue]="cofog.code">{{ cofog.name }}</option>
                            }
                        </select>
                        @if (form.controls.cofog2.touched && form.controls.cofog2.invalid) {
                            <div class="invalid-feedback">Το πεδίο είναι υποχρεωτικό</div>
                        }
                    </div>
                }

                @if (cofog2_selected) {
                    <div class="mb-3">
                        <label for="cofog3" class="form-label">Θεματική Περιοχή COFOG:</label>
                        <select
                            class="form-select"
                            [class.is-invalid]="form.controls.cofog3.touched && form.controls.cofog3.invalid"
                            aria-label="Default select example"
                            id="cofog3"
                            formControlName="cofog3"
                        >
                            <option value="" disabled selected>Επιλέξτε Θεματική Περιοχή COFOG</option>
                            @for (cofog of cofog3; track $index) {
                                <option [ngValue]="cofog.code">{{ cofog.name }}</option>
                            }
                        </select>
                        @if (form.controls.cofog3.touched && form.controls.cofog3.invalid) {
                            <div class="invalid-feedback">Το πεδίο είναι υποχρεωτικό</div>
                        }
                    </div>
                }

                <div class="mb-3 d-flex gap-2">
                    <button type="button" class="btn btn-primary" (click)="addLegalProvision()">
                        Εισαγωγή Διάταξης
                    </button>
                </div>

                <button type="button" class="btn btn-primary" type="submit" [disabled]="!form.valid">Υποβολή</button>
            </form>
        </div>
    </div>
</div>
